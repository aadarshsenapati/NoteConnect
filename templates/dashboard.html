{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <link rel="icon" href="{% static 'img/NoteConnectlogo.png' %}" style="height:20px;width:20px;">
    <link rel="icon" href="{% static 'img/NoteConnectlogo.png' %}" style="height:20px;width:20px;">
</head>
<body>
    <header>
        <!-- <div class="logo">Logo</div> -->
        <a href="/dashboard"><img class="logo" src="{% static 'img/NoteConnectlogo.png' %}" height="512"></a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <div class="section">
            <a href="/notes"><button>Notes</button></a>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <div class="section">
                <a href="/pyq"><button>PYQ</button></a>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <div class="section">
                <a href="/upload"><button>Upload</button></a>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <div class="section">
                <a href="/chat"><button>Chatbox</button></a>
            </div>
        </div>
        <div class="search-bar">
            <input type="text" input type="text" id="dashboard-search" placeholder="Search...">
            <!-- <button id="search-button">Search</button> -->
            <i class="fa-solid fa-magnifying-glass"></i>
        </div>
        <div class="profile">
            <!-- <img src="profile-icon.png" alt="Profile"> -->
            <!-- <a href="#" style="text-decoration: none;color:white"><i class="fa-regular fa-user" ></i></a> -->
             <a href="/log_o"><button class="logout-button" >Log Out</button></a>
        </div>
    </header>
    <main>
        <div class="welcome">
            <h1 >Welcome, {{ user.first_name }}</h1>
            <ul id="search-results">
                <!-- Search results will be dynamically inserted here -->
            </ul>
        </div>
        <div class="table-points">
            <table style="align-items: center;  border: 1px solid black;">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Likes</th>
                        <th>Dislikes</th>
                        <th>Points</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file_data in files %}
                        <tr>
                            <td>{{ file_data.file.title }}</td>
                            <td>{{ file_data.file.likes }}</td>
                            <td>{{ file_data.file.dislikes }}</td>
                            <td>{{ file_data.file.points }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <script>
        $(document).ready(function() {
            // Search functionality
            $('#dashboard-search').on('input', function() {
                const query = $(this).val();
                $.ajax({
                    url: "{% url 'search_dashboard' %}", // URL for the search endpoint
                    data: { q: query },
                    success: function(response) {
                        const results = response.results;
                        const resultsContainer = $('#search-results');
                        resultsContainer.empty();
                        if (results.length > 0) {
                            results.forEach(function(result) {
                                resultsContainer.append(`
                                    <li>
                                        <strong>Title:</strong> ${result.title}<br>
                                        <strong>Category:</strong> ${result.category}<br>
                                        <a href="${result.url}">View File</a>
                                    </li>
                                `);
                            });
                        } else {
                            resultsContainer.append('<li>No results found</li>');
                        }
                    },
                    error: function() {
                        alert('An error occurred while searching.');
                    }
                });
            });
        });
    </script>
</body>
</html>